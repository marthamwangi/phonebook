<div class="container">
  <div class="header">
    <div class="title">
      <h1 class="mb-3 pt-5">My Contacts <a routerLink="/create/new" class=""><i class="bi bi-plus-lg fs-1"></i></a>
      </h1>
    </div>
    <small class="contact-count">
      Contacts ({{ (renderedContacts$ | async)?.length }})
    </small>
    <div class="view-types">
      <span (click)="changeViewStyle()">
        <i class="bi bi-{{ view === 'list' ? 'grid-fill' : 'list-columns'}}"></i>
      </span>
    </div>
    <div class="search">
      <form [formGroup]="searchForm">
        <input type="text" placeholder="search by name" class="form-control" formControlName="searchQuery">
      </form>
    </div>
  </div>

  <div class="content">
    <ng-container *ngTemplateOutlet="view === 'list' ? listTemplate : gridTemplate; context:{
  contacts: (renderedContacts$ | async)}"></ng-container>
  </div>
</div>

<ng-template #listTemplate let-contacts="contacts">
  <div class="list">
    <div *ngFor="let contact of contacts; trackBy: trackFunction" class="list-item">
      <div class="list-item-avatar">
        <img *ngIf="contact.contactImage" src="{{ contact.contactImage }}" alt="{{ contact.firstName }}"
          class="img-thumbnail">
        <span *ngIf="!contact.contactImage">{{ contact.firstName.charAt(0) }}</span>
      </div>
      <div class="list-item-name-and-phone">
        <div class="list-item-name-and-phone-name">{{ contact.firstName }} {{ contact.lastName }}</div>
        <div class="list-item-name-and-phone-phone">{{ contact.phoneNumber }}</div>
      </div>
      <div class="list-item-actions">
        <span class="list-item-actions">
          <ng-template [ngTemplateOutlet]="checkboxTemplate" [ngTemplateOutletContext]="{
  id: contact.id
  }"></ng-template>
        </span>
        <span class="list-item-actions">
          <ng-template [ngTemplateOutlet]="editContactTemplate" [ngTemplateOutletContext]="{
  id: contact.id
  }"></ng-template>
        </span>
        <span class="list-item-actions">
          <ng-template [ngTemplateOutlet]="deleteContactTemplate" [ngTemplateOutletContext]="{
  contact: contact
  }"></ng-template>
        </span>
        <span class="list-item-actions">
          <ng-template [ngTemplateOutlet]="viewContactTemplate" [ngTemplateOutletContext]="{
  id: contact.id
  }"></ng-template>
        </span>
      </div>
    </div>

    <!-- <ul>
  <li *ngFor="let contact of contacts">{{contact.firstName}} {{contact.lastName}}
  <ng-template [ngTemplateOutlet]="checkboxTemplate" [ngTemplateOutletContext]="{
  id: contact.id
  }"></ng-template>
  <ng-template [ngTemplateOutlet]="editContactTemplate" [ngTemplateOutletContext]="{
  id: contact.id
  }"></ng-template>
  <ng-template [ngTemplateOutlet]="deleteContactTemplate" [ngTemplateOutletContext]="{
  contact: contact
  }"></ng-template>
  <ng-template [ngTemplateOutlet]="viewContactTemplate" [ngTemplateOutletContext]="{
  id: contact.id
  }"></ng-template>
  </li>
  </ul> -->
  </div>
</ng-template>

<ng-template #gridTemplate let-contacts="contacts">
  <div class="grid text-center">
    <div *ngFor="let contact of contacts; trackBy: trackFunction"
      class="shadow-lg p-3 mb-5 bg-body rounded g-col-6 g-col-md-4 grid-item">
      <div class="grid-item-avatar">
        <img *ngIf="contact.contactImage" src="{{ contact.contactImage }}" alt="{{ contact.firstName }}"
          class="img-thumbnail">
        <span *ngIf="!contact.contactImage">{{ contact.firstName.charAt(0) }}</span>
      </div>
      <div class="grid-item-name-and-phone">
        <div class="grid-item-name-and-phone-name">{{ contact.firstName }} {{ contact.lastName }}</div>
        <div class="grid-item-name-and-phone-phone">{{ contact.phoneNumber }}</div>
      </div>
      <div class="grid-item-actions mt-3">
        <span class="grid-item-actions">
          <ng-template [ngTemplateOutlet]="checkboxTemplate" [ngTemplateOutletContext]="{
  id: contact.id
  }"></ng-template>
        </span>
        <span class="grid-item-actions">
          <ng-template [ngTemplateOutlet]="editContactTemplate" [ngTemplateOutletContext]="{
  id: contact.id
  }"></ng-template>
        </span>
        <span class="grid-item-actions">
          <ng-template [ngTemplateOutlet]="deleteContactTemplate" [ngTemplateOutletContext]="{
  contact: contact
  }"></ng-template>
        </span>
        <span class="grid-item-actions">
          <ng-template [ngTemplateOutlet]="viewContactTemplate" [ngTemplateOutletContext]="{
  id: contact.id
  }"></ng-template>
        </span>
      </div>
    </div>
    <!-- <ul>
  <li *ngFor="let contact of contacts">{{contact.firstName}} {{contact.lastName}}
  <ng-template [ngTemplateOutlet]="checkboxTemplate" [ngTemplateOutletContext]="{
  id: contact.id
  }"></ng-template>

  <ng-template [ngTemplateOutlet]="editContactTemplate" [ngTemplateOutletContext]="{
  id: contact.id
  }"></ng-template>

  <ng-template [ngTemplateOutlet]="deleteContactTemplate" [ngTemplateOutletContext]="{
  contact: contact
  }"></ng-template>

  <ng-template [ngTemplateOutlet]="viewContactTemplate" [ngTemplateOutletContext]="{
  id: contact.id
  }"></ng-template>
  </li>
  </ul> -->
  </div>
</ng-template>

<ng-template #checkboxTemplate let-id="id">
  <input type="checkbox" #checkboxInputElement
    (change)="addOrRemoveFromContactsToDelete(checkboxInputElement.checked ? 'add' : 'remove', id)">
</ng-template>

<ng-template #editContactTemplate let-id="id">
  <a routerLink="/create/{{id}}">
    <i class="bi bi-pencil-fill"></i>
  </a>
</ng-template>

<ng-template #deleteContactTemplate let-contact="contact">
  <!-- <button (click)="markContactToDelete(contact)">Delete</button> -->
  <i class="bi bi-trash-fill"></i>
</ng-template>

<ng-template #viewContactTemplate let-id="id">
  <a routerLink="/view/{{id}}">
    <i class="bi bi-arrows-angle-expand"></i>
  </a>
</ng-template>

<div *ngIf="contactIdsToDelete.length || contactToDelete">
  <ng-container *ngTemplateOutlet="contactToDelete ? deleteOneContactTemplate : deleteManyContacts"></ng-container>
  <ng-template #deleteOneContactTemplate>
    {{contactToDelete?.firstName}} {{contactToDelete?.lastName}} will be deleted
    <span (click)="deleteOneContact(contactToDelete?.id)">Delete</span>
  </ng-template>

  <ng-template #deleteManyContacts>
    you are about to delete {{contactIdsToDelete.length}}
    <span (click)="deleteSelectedContacts()">Delete</span>
  </ng-template>

</div>

<!-- <div class="container">
  <div class="header p-3">
  <a routerLink="/create/new" class="position-absolute top-0 end-0 me-2 pt-3"><i class="bi bi-plus-lg fs-1"></i></a>
  <h1 class="mb-3 pt-5">My Contacts</h1>
  <div class="d-flex justify-content-between align-items-center">
  <form [formGroup]="searchForm">
  <input type="text" placeholder="search by name" class="form-control" formControlName="searchQuery">
  </form>

  <span class="view" (click)="changeViewStyle()">
  <i class="bi bi-{{ view === 'list' ? 'list-ul' : 'grid-fill'}}"></i>
  </span>
  </div>

  </div>
  <div class="">

  <ng-container *ngTemplateOutlet="view === 'list' ? listTemplate : gridTemplate; context:{
  contacts: (renderedContacts$ | async)}"></ng-container>

  <ng-template #listTemplate let-contacts="contacts">
  <ul>
  <li *ngFor="let contact of contacts">{{contact.firstName}} {{contact.lastName}}
  <ng-template [ngTemplateOutlet]="checkboxTemplate" [ngTemplateOutletContext]="{
  id: contact.id
  }"></ng-template>
  <ng-template [ngTemplateOutlet]="editContactTemplate" [ngTemplateOutletContext]="{
  id: contact.id
  }"></ng-template>
  <ng-template [ngTemplateOutlet]="deleteContactTemplate" [ngTemplateOutletContext]="{
  contact: contact
  }"></ng-template>
  <ng-template [ngTemplateOutlet]="viewContactTemplate" [ngTemplateOutletContext]="{
  id: contact.id
  }"></ng-template>
  </li>
  </ul>
  </ng-template>

  <ng-template #gridTemplate let-contacts="contacts">
  <ul>
  <li *ngFor="let contact of contacts">{{contact.firstName}} {{contact.lastName}}
  <ng-template [ngTemplateOutlet]="checkboxTemplate" [ngTemplateOutletContext]="{
  id: contact.id
  }"></ng-template>

  <ng-template [ngTemplateOutlet]="editContactTemplate" [ngTemplateOutletContext]="{
  id: contact.id
  }"></ng-template>

  <ng-template [ngTemplateOutlet]="deleteContactTemplate" [ngTemplateOutletContext]="{
  contact: contact
  }"></ng-template>

  <ng-template [ngTemplateOutlet]="viewContactTemplate" [ngTemplateOutletContext]="{
  id: contact.id
  }"></ng-template>
  </li>
  </ul>
  </ng-template>

  <ng-template #checkboxTemplate let-id="id">
  <input type="checkbox" #checkboxInputElement
  (change)="addOrRemoveFromContactsToDelete(checkboxInputElement.checked ? 'add' : 'remove', id)">
  </ng-template>

  <ng-template #editContactTemplate let-id="id">
  <a routerLink="/create/{{id}}">edit</a>
  </ng-template>

  <ng-template #deleteContactTemplate let-contact="contact">
  <button (click)="markContactToDelete(contact)">Delete</button>
  </ng-template>

  <ng-template #viewContactTemplate let-id="id">
  <a routerLink="/view/{{id}}">view</a>
  </ng-template>

  <div *ngIf="contactIdsToDelete.length || contactToDelete">
  <ng-container *ngTemplateOutlet="contactToDelete ? deleteOneContactTemplate : deleteManyContacts"></ng-container>
  <ng-template #deleteOneContactTemplate>
  {{contactToDelete?.firstName}} {{contactToDelete?.lastName}} will be deleted
  <button (click)="deleteOneContact(contactToDelete?.id)">Delete</button>
  </ng-template>

  <ng-template #deleteManyContacts>
  you are about to delete {{contactIdsToDelete.length}}
  <button (click)="deleteSelectedContacts()">Delete</button>
  </ng-template>

  </div>
  </div>

  </div> -->
